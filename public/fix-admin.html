<!DOCTYPE html>
<html>
<head>
    <title>Fix Admin Access</title>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 600px; 
            margin: 40px auto; 
            padding: 20px;
        }
        .form-group { 
            margin-bottom: 15px;
        }
        label { 
            display: block; 
            margin-bottom: 5px;
            font-weight: bold;
        }
        input { 
            width: 100%; 
            padding: 10px; 
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button { 
            padding: 10px 20px; 
            background: #4CAF50; 
            color: white; 
            border: none; 
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover { 
            background: #45a049;
        }
        #message { 
            margin-top: 20px; 
            padding: 10px;
            border-radius: 4px;
        }
        .success { 
            background: #dff0d8; 
            color: #3c763d;
        }
        .error { 
            background: #f2dede; 
            color: #a94442;
        }
    </style>
</head>
<body>
    <h1>Fix Admin Access</h1>
    
    <div class="form-group">
        <label>Email:</label>
        <input type="email" id="email" value="shannu@admin.com">
    </div>
    <div class="form-group">
        <label>Password:</label>
        <input type="password" id="password" value="667700">
    </div>
    <button onclick="fixAdmin()">Fix Admin Access</button>
    <div id="message"></div>

    <script>
    async function fixAdmin() {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const messageEl = document.getElementById('message');
        
        try {
            // First, try to log in
            messageEl.textContent = 'Attempting to log in...';
            messageEl.className = '';
            
            const loginResponse = await axios({
                method: 'post',
                url: 'http://localhost:3000/api/v1/auth/login',
                data: { email, password },
                withCredentials: true,
                validateStatus: () => true // Don't throw on HTTP error
            });
            
            if (loginResponse.status === 200) {
                messageEl.className = 'success';
                messageEl.textContent = '✅ Login successful! You should be redirected to the admin panel.';
                window.location.href = '/admin';
                return;
            }
            
            // If login failed, try to create the admin user
            messageEl.textContent = 'Login failed. Attempting to create admin user...';
            
            const signupResponse = await axios({
                method: 'post',
                url: 'http://localhost:3000/api/v1/auth/signup',
                data: {
                    name: 'Admin User',
                    email,
                    password,
                    passwordConfirm: password,
                    role: 'admin',
                    phone: '+1234567890',
                    isVerified: true,
                    active: true
                },
                withCredentials: true,
                validateStatus: () => true // Don't throw on HTTP error
            });
            
            if (signupResponse.status === 201) {
                messageEl.className = 'success';
                messageEl.textContent = '✅ Admin user created successfully! Attempting to log in...';
                
                // Try to log in with the new account
                setTimeout(() => {
                    window.location.href = '/login';
                }, 2000);
            } else {
                messageEl.className = 'error';
                messageEl.textContent = `❌ Error: ${signupResponse.data?.message || 'Failed to create admin user'}`;
                console.error('Signup error:', signupResponse);
            }
            
        } catch (error) {
            console.error('Error:', error);
            messageEl.className = 'error';
            messageEl.textContent = `❌ Error: ${error.message}`;
        }
    }
    </script>
</body>
</html>
